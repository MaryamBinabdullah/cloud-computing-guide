// Translation dictionary for Arabic
const translations = {
    // Header
    "Cloud Computing": "الحوسبة السحابية",
    "Master the digital infrastructure that powers modern technology": "أتقن البنية التحتية الرقمية التي تدفع التكنولوجيا الحديثة",
    "Explore Cloud Concepts": "استكشف مفاهيم السحابة",

    // Navigation & Sections
    "What You'll Master": "ما ستتقنه",
    "Financial Model: CapEx vs. OpEx": "النموذج المالي: الإنفاق الرأسمالي مقابل التشغيلي",
    "Service Models": "نماذج الخدمة",
    "Security: Shared Responsibility": "الأمان: المسؤولية المشتركة",
    "Hands-On Lab: Infrastructure as Code": "معمل عملي: البنية التحتية كود",
    "Cloud Challenge Quiz": "اختبار تحدي السحابة",
    "Your Cloud Journey Starts Now": "رحلتك السحابية تبدأ الآن",

    // Financial Section
    "Capital Expenditure (CapEx)": "النفقات الرأسمالية",
    "Traditional IT: Purchase Assets Outright": "تكنولوجيا المعلومات التقليدية: شراء الأصول مباشرة",
    "Operational Expenditure (OpEx)": "النفقات التشغيلية",
    "Cloud IT: Rent as a Utility Service": "تكنولوجيا المعلومات السحابية: الاستئجار كخدمة مساعدة",
    "Fixed Cost:": "التكلفة الثابتة:",
    "Waste Risk:": "مخاطر الهدر:",
    "High chance of over-provisioning or under-provisioning.": "احتمالية عالية للإفراط في التخصيص أو نقصه.",
    "Full Responsibility:": "المسؤولية الكاملة:",
    "Customer handles all maintenance and upgrades.": "العميل يتولى جميع أعمال الصيانة والترقيات.",
    "Variable Cost:": "التكلفة المتغيرة:",
    "Pay-as-you-go; costs scale with usage.": "الدفع حسب الاستخدام؛ التكاليف تتغير مع حجم الاستخدام.",
    "Elasticity:": "المرونة:",
    "Instantly scale capacity to match real-time demand.": "تغيير السعة فوراً لتتناسب مع الطلب الفعلي.",
    "Shared Responsibility:": "المسؤولية المشتركة:",
    "Provider manages physical hardware.": "مزود الخدمة يدير الأجهزة المادية.",

    // Service Models
    "Understanding the spectrum of cloud service models from infrastructure to software.": "فهم طيف نماذج الخدمات السحابية من البنية التحتية إلى البرمجيات.",
    "IaaS": "IaaS",
    "Infrastructure as a Service": "البنية التحتية كخدمة",
    "PaaS": "PaaS", 
    "Platform as a Service": "المنصة كخدمة",
    "SaaS": "SaaS",
    "Software as a Service": "البرمجيات كخدمة",
    "OS, runtime, applications, data": "نظام التشغيل، وقت التشغيل، التطبيقات، البيانات",
    "Physical servers, storage, networking": "الخوادم المادية، التخزين، الشبكات",
    "Application code and data": "كود التطبيق والبيانات",
    "OS, middleware, runtime, servers": "نظام التشغيل، البرمجيات الوسيطة، وقت التشغيل، الخوادم",
    "User access and configuration": "وصول المستخدم والإعدادات",
    "Entire stack (infrastructure to application)": "المجموعة الكاملة (من البنية التحتية إلى التطبيق)",

    // Security Section
    "Security of the Cloud": "أمان السحابة",
    "Security in the Cloud": "الأمان في السحابة",
    "The cloud provider secures the underlying infrastructure:": "مزود الخدمة السحابية يؤمن البنية التحتية الأساسية:",
    "The customer is responsible for everything they deploy or configure:": "العميل مسؤول عن كل ما ينشره أو يضبطه:",
    "Physical data centers": "مراكز البيانات المادية",
    "Core network infrastructure": "البنية التحتية الأساسية للشبكة", 
    "Host OS and hypervisors": "نظام التشغيل المضيف وبرامج المحاكاة الافتراضية",
    "Data protection (encryption)": "حماية البيانات (التشفير)",
    "Identity and Access Management (IAM)": "إدارة الهوية والوصول",
    "Correct configuration management": "الإدارة الصحيحة للإعدادات",

    // Quiz Questions
    "What is the financial model of the cloud called?": "ما هو النموذج المالي للحوسبة السحابية؟",
    "Who is responsible for securing uploaded data?": "من المسؤول عن تأمين البيانات المرفوعة؟",
    "Which service model gives the most OS control?": "أي نموذج خدمة يعطي أكبر تحكم في نظام التشغيل؟",
    "What is defining infrastructure with code called?": "ما اسم تعريف البنية التحتية باستخدام الكود؟",

    // Quiz Answers
    "Operational Expenditure (OpEx).": "النفقات التشغيلية (OpEx).",
    "The Customer.": "العميل.",
    "Infrastructure as a Service (IaaS).": "البنية التحتية كخدمة (IaaS).", 
    "Infrastructure as Code (IaC).": "البنية التحتية كود (IaC).",

    // Footer
    "Cloud Computing Educational Resource": "مورد تعليمي للحوسبة السحابية",
    "A foundational guide for students and lifelong learners.": "دليل أساسي للطلاب والمتعلمين مدى الحياة.",
    "© 2025 | Optimized for Clarity and Engagement": "© 2025 | محسن للوضوح والمشاركة",

    // Interactive Elements
    "Calculate Your Potential Savings": "احسب مدخراتك المحتملة",
    "Compare traditional CapEx spending with cloud OpEx models. Adjust the values below to see how cloud computing can transform your IT costs.": "قارن الإنفاق الرأسمالي التقليدي مع نماذج الإنفاق التشغيلي السحابي. اضبط القيم أدناه لترى كيف يمكن للحوسبة السحابية تحويل تكاليف تكنولوجيا المعلومات الخاصة بك.",
    "Number of Users:": "عدد المستخدمين:",
    "Storage Needed (GB):": "مساحة التخزين المطلوبة (جيجابايت):",
    "Monthly Usage (hours):": "ساعات الاستخدام الشهرية:",
    "users": "مستخدم",
    "GB": "جيجابايت", 
    "hours": "ساعات",
    "Traditional CapEx": "النفقات الرأسمالية التقليدية",
    "Cloud OpEx": "النفقات التشغيلية السحابية",
    "Annual Savings": "التوفير السنوي",
    "Upfront + Maintenance": "مقدم + صيانة",
    "Monthly Cost": "التكلفة الشهرية",
    "First Year": "السنة الأولى",

    // Service Model Configurator
    "Configure Your Cloud Setup": "اضبط إعدادات السحابة الخاصة بك",
    "Choose your requirements and see which service model fits best. This helps you understand the practical decision-making process.": "اختر متطلباتك وشاهد أي نموذج خدمة يناسبك أفضل. هذا يساعدك على فهم عملية اتخاذ القرار العملية.",
    "How much control do you need?": "ما مقدار التحكم الذي تحتاجه؟",
    "Full Control (OS, Runtime)": "تحكم كامل (نظام التشغيل، وقت التشغيل)",
    "Application-Level Control": "تحكم على مستوى التطبيق",
    "Just Use the Software": "مجرد استخدام البرنامج",
    "Development Team Size": "حجم فريق التطوير",
    "Small Team (1-5)": "فريق صغير (1-5)",
    "Medium Team (6-15)": "فريق متوسط (6-15)", 
    "Large Team (15+)": "فريق كبير (15+)",
    "Application Type": "نوع التطبيق",
    "Custom Business Application": "تطبيق أعمال مخصص",
    "Standard Software (Email, CRM)": "برنامج قياسي (بريد إلكتروني، CRM)",
    "Microservices Architecture": "هندسة الخدمات المصغرة",
    "Recommended Service Model:": "نموذج الخدمة الموصى به:",
    "You need full control over the operating system and runtime environment. IaaS gives you maximum flexibility.": "أنت بحاجة إلى تحكم كامل في نظام التشغيل وبيئة وقت التشغيل. IaaS يمنحك أقصى مرونة.",

    // IAM Simulator
    "Practice Creating Secure IAM Policies": "تمرن على إنشاء سياسات IAM آمنة",
    "Learn how to create least-privilege security policies by configuring access controls below.": "تعلم كيفية إنشاء سياسات أمان بأقل صلاحيات من خلال ضبط عناصر التحكم في الوصول أدناه.",
    "User Role": "دور المستخدم",
    "Developer": "مطور",
    "Administrator": "مدير",
    "Read-Only User": "مستخدم للقراءة فقط", 
    "Services Needed": "الخدمات المطلوبة",
    "Hold Ctrl to select multiple services": "اضغط Ctrl لاختيار خدمات متعددة",
    "Generated IAM Policy:": "سياسة IAM المُنشأة:",

    // Terraform Lab
    "Create an S3 Bucket using Terraform": "إنشاء دلو S3 باستخدام Terraform",
    "Follow these steps to create your first cloud resource:": "اتبع هذه الخطوات لإنشاء أول مورد سحابي لك:",
    "Edit the Terraform configuration below to customize your bucket name": "عدل إعدادات Terraform أدناه لتخصيص اسم الدلو الخاص بك",
    "Click \"Run Configuration\" to validate your code": "انقر \"تشغيل الإعدادات\" للتحقق من صحة الكود الخاص بك",
    "Check the output to see what would be created": "تحقق من المخرجات لترى ما سيتم إنشاؤه",
    "Reset": "إعادة تعيين",
    "Run Configuration": "تشغيل الإعدادات",
    "Real AWS Challenge": "تحدي AWS حقيقي",
    "Ready for the real thing?": "مستعد للتجربة الحقيقية؟",
    "Here's how to try this with actual AWS:": "إليك كيفية تجربة هذا مع AWS الفعلي:",
    "Create an AWS Free Tier account": "إنشاء حساب AWS مجاني",
    "Install Terraform on your computer": "تثبيت Terraform على جهازك",
    "Create a new file with the code above": "إنشاء ملف جديد بالكود أعلاه",
    "Run": "تشغيل",
    "then": "ثم",
    "If everything looks good, run": "إذا بدا كل شيء جيداً، شغل",

    // Explanatory Text
    "Cloud computing is the foundation of modern IT. This guide delivers a clear, accessible overview of its core concepts.": "الحوسبة السحابية هي أساس تكنولوجيا المعلومات الحديثة. يقدم هذا الدليل نظرة عامة واضحة وسهلة لمفاهيمها الأساسية.",
    "Understanding the fundamental shift in IT spending from capital to operational expenditure.": "فهم التحول الأساسي في إنفاق تكنولوجيا المعلومات من النفقات الرأسمالية إلى التشغيلية.",
    "Understanding the division of security responsibilities between cloud providers and customers.": "فهم تقسيم مسؤوليات الأمان بين مزودي الخدمات السحابية والعملاء.",
    "Learn by doing. Write your first cloud configuration using real Infrastructure as Code tools.": "تعلم بالممارسة. اكتب أول إعداد سحابي لك باستخدام أدوات البنية التحتية كود الحقيقية.",
    "Test your knowledge! Click on each question to reveal the answer and get detailed feedback.": "اختبر معرفتك! انقر على كل سؤال للكشف عن الإجابة والحصول على تعليقات مفصلة.",
    "The Core Shift:": "التحول الأساسي:",
    "Cloud converts fixed, risky costs into agile, variable costs, allowing your spending to directly reflect and support business activity.": "تحول السحابة التكاليف الثابتة والمحفوفة بالمخاطر إلى تكاليف مرنة ومتغيرة، مما يسمح لإنفاقك بأن يعكس ويدعم نشاط عملك مباشرة.",
    "Trade-off Principle:": "مبدأ المفاضلة:",
    "As you move toward SaaS, convenience increases, but your control and customization options decrease. Choose based on required control and team expertise.": "بينما تنتقل نحو SaaS، تزداد الراحة، لكن خيارات التحكم والتخصيص تقل. اختر بناءً على التحكم المطلوب وخبرة الفريق.",
    "Critical Note:": "ملاحظة هامة:",
    "Most cloud breaches stem from customer configuration errors (\"Security in the Cloud\"), not platform vulnerabilities.": "معظم اختراقات السحابة تنبع من أخطاء إعداد العملاء (\"الأمان في السحابة\")، وليس من ثغرات المنصة."
};

// RTL languages
const rtlLanguages = ['ar'];

class TranslationManager {
    constructor() {
        this.currentLang = 'en';
        this.isRTL = false;
        this.init();
    }

    init() {
        this.createLanguageSelector();
        this.loadSavedLanguage();
    }

    createLanguageSelector() {
        const selector = document.createElement('div');
        selector.className = 'language-selector';
        selector.innerHTML = `
            <button class="lang-btn active" data-lang="en">EN</button>
            <button class="lang-btn" data-lang="ar">العربية</button>
        `;

        // Add styles
        const styles = `
            .language-selector {
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 1000;
                background: rgba(255,255,255,0.95);
                backdrop-filter: blur(10px);
                border-radius: 25px;
                padding: 5px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                border: 1px solid rgba(79, 70, 229, 0.3);
                display: flex;
                gap: 2px;
            }
            .lang-btn {
                padding: 8px 16px;
                border: none;
                background: transparent;
                border-radius: 20px;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s ease;
                color: var(--text);
                font-size: 0.9rem;
            }
            .lang-btn.active {
                background: linear-gradient(135deg, var(--primary), var(--secondary));
                color: white;
                box-shadow: 0 2px 10px rgba(79, 70, 229, 0.3);
            }
            .lang-btn:hover:not(.active) {
                background: rgba(79, 70, 229, 0.1);
                transform: translateY(-1px);
            }
            body.rtl .language-selector {
                right: auto;
                left: 20px;
            }
            
            /* Keep section titles centered in RTL */
            body.rtl .section-header,
            body.rtl .section-title,
            body.rtl .section-subtitle {
                text-align: center !important;
            }
            
            @media (max-width: 768px) {
                .language-selector {
                    top: 15px;
                    right: 15px;
                    padding: 4px;
                }
                .lang-btn {
                    padding: 6px 12px;
                    font-size: 0.85rem;
                }
                body.rtl .language-selector {
                    right: auto;
                    left: 15px;
                }
            }
        `;

        const styleSheet = document.createElement('style');
        styleSheet.textContent = styles;
        document.head.appendChild(styleSheet);

        // Add event listeners
        selector.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                const lang = e.target.getAttribute('data-lang');
                this.switchLanguage(lang);
            });
        });

        document.body.appendChild(selector);
    }

    switchLanguage(lang) {
        console.log('Switching language to:', lang);
        
        // Update active button
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`.lang-btn[data-lang="${lang}"]`).classList.add('active');
        
        this.currentLang = lang;
        this.isRTL = rtlLanguages.includes(lang);
        
        // Update body direction
        document.body.classList.toggle('rtl', this.isRTL);
        
        // Translate content
        this.translatePage();
        
        // Save preference
        localStorage.setItem('preferredLanguage', lang);
    }

    translatePage() {
        if (this.currentLang === 'en') {
            // Reload page to reset to English (simplest solution)
            window.location.reload();
            return;
        }

        // Arabic translation logic
        const walker = document.createTreeWalker(
            document.body,
            NodeFilter.SHOW_TEXT,
            null,
            false
        );

        let node;
        const textNodes = [];

        while (node = walker.nextNode()) {
            if (node.textContent.trim() && 
                node.parentNode.nodeName !== 'SCRIPT' && 
                node.parentNode.nodeName !== 'STYLE' &&
                !node.parentNode.classList.contains('CodeMirror')) {
                textNodes.push(node);
            }
        }

        textNodes.forEach(node => {
            const originalText = node.textContent.trim();
            if (translations[originalText]) {
                node.textContent = translations[originalText];
            }
        });

        // Update placeholders and other attributes
        document.querySelectorAll('[placeholder]').forEach(el => {
            const original = el.getAttribute('placeholder');
            if (translations[original]) {
                el.setAttribute('placeholder', translations[original]);
            }
        });
    }

    loadSavedLanguage() {
        const savedLang = localStorage.getItem('preferredLanguage');
        if (savedLang && savedLang === 'ar') {
            this.switchLanguage('ar');
        }
    }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    window.translationManager = new TranslationManager();
});